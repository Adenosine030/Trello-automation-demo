name: Trello Automation

# Trigger: When code is pushed to repository
on:
  push:
    branches:
      - main

jobs:
  create-trello-card:
    name: Create Trello Card from Commit
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Create Trello Card
        env:
          TRELLO_KEY: ${{ secrets.TRELLO_KEY }}
          TRELLO_TOKEN: ${{ secrets.TRELLO_TOKEN }}
          TRELLO_LIST_ID: ${{ secrets.TRELLO_LIST_ID }}
        run: |
          # Extract commit information
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          COMMIT_URL="${{ github.event.head_commit.url }}"
          AUTHOR_NAME="${{ github.event.head_commit.author.name }}"
          BRANCH_NAME="${{ github.ref_name }}"
          
          # Create card name
          CARD_NAME="Commit: $COMMIT_MESSAGE"
          
          # Create card description
          CARD_DESC="**Commit Message:** $COMMIT_MESSAGE%0A**Author:** $AUTHOR_NAME%0A**Branch:** $BRANCH_NAME%0A**URL:** $COMMIT_URL"
          
          # Call Trello API to create card
          curl -X POST "https://api.trello.com/1/cards" \
            -H "Content-Type: application/json" \
            -d "{
              \"key\": \"$TRELLO_KEY\",
              \"token\": \"$TRELLO_TOKEN\",
              \"idList\": \"$TRELLO_LIST_ID\",
              \"name\": \"$CARD_NAME\",
              \"desc\": \"$CARD_DESC\"
            }"
          
          echo "âœ… Trello card created successfully!"
